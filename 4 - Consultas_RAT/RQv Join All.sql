SELECT NATCODIGO,rat_efetivo.NUM_ATIVIDADE,
rat_efetivo.NUM_MATRICULA,
rat_efetivo.NOME,NOM_CARGO,
rat_efetivo.COD_UNIDADE_SERVICO,
rat_efetivo.NOM_UNIDADE,
rat_produtividade.QUANTIDADE,
sum(if(rat_produtividade.QUANTIDADE = 'Qde de veiculos fiscalizados',1,0)) as 'Veic'
FROM rat
INNER JOIN rat_efetivo ON rat.RATNUM_ATIVIDADE = rat_efetivo.NUM_ATIVIDADE
INNER JOIN rat_produtividade ON rat.RATNUM_ATIVIDADE = rat_produtividade.RATNUM_ATIVIDADE
INNER JOIN rat_viaturas ON rat.RATNUM_ATIVIDADE = rat_viaturas.NUM_ATIVIDADE
where DTA_INICIO BETWEEN '2017-01-01' AND '2018-12-31'
and MUNICIPIO in ('IGARATINGA',
'MARAVILHAS',
'ONCA DO PITANGUI',
'PAPAGAIOS',
'PARA DE MINAS',
'PEQUI',
'SAO JOSE DA VARGINHA',
'CARMO DO CAJURU',
'CLAUDIO',
'DIVINOPOLIS',
'ITATIAIUCU',
'ITAUNA',
'SAO GONCALO DO PARA',
'ARAUJOS',
'CONCEICAO DO PARA',
'LEANDRO FERREIRA',
'NOVA SERRANA',
'PERDIGAO',
'PITANGUI',
'ARCOS',
'BAMBUI',
'CAMACHO',
'CORREGO FUNDO',
'FORMIGA',
'IGUATAMA',
'ITAPECERICA',
'MEDEIROS',
'PAINS',
'PIMENTA',
'SAO SEBASTIAO DO OESTE',
'TAPIRAI',
'ABAETE',
'BIQUINHAS',
'BOM DESPACHO',
'CEDRO DO ABAETE',
'CORREGO DANTA',
'DORES DO INDAIA',
'ESTRELA DO INDAIA',
'JAPARAIBA',
'LAGOA DA PRATA',
'LUZ',
'MARTINHO CAMPOS',
'MOEMA',
'MORADA NOVA DE MINAS',
'PAINEIRAS',
'PEDRA DO INDAIA',
'POMPEU',
'QUARTEL GERAL',
'SANTO ANTONIO DO MONTE',
'SERRA DA SAUDADE')
and NATCODIGO in ('Y07001','Y07003','Y07004','Y07005')

group by rat.RATNUM_ATIVIDADE
order by DTA_INICIO desc